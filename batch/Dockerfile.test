FROM {{ base_image.image }}

COPY gear/setup.py /gear/
COPY gear/gear/ /gear/gear/
RUN python3 -m pip install --no-cache-dir /gear \
  && rm -rf /gear

COPY batch_client/setup.py /batch_client/
COPY batch_client/batch_client /batch_client/batch_client
RUN pip3 install --no-cache-dir /batch_client && \
  rm -rf /batch_client

COPY batch/test/ /test/

CMD ["python3", "-m", "pytest", "-v", "-s", "/test/"]
