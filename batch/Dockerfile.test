FROM alpine:3.8

RUN apk add --no-cache \
  g++ \
  gcc \
  libc-dev \
  make \
  py3-cffi \
  py3-cryptography \
  python3 \
  python3-dev \
  && true

COPY setup.py /batch/
COPY batch /batch/batch/
RUN pip3 install --no-cache-dir pytest /batch

COPY hailjwt/ /hailjwt/
RUN cd /hailjwt && python3 setup.py install

COPY test /test

CMD ["python3", "-m", "pytest", "-v", "--maxfail=1", "test"]
