 - rebuild the image:
   - add emacs-nox to image
   - installed pip packages to image
   - pre-pull used docker images
   - google libraries

sortedcontainers google-api-python-client google-cloud==0.32.0 uvloop

rm pipeline.log; GOOGLE_CLOUD_DISABLE_GRPC=true ZONE=us-central1-a PROJECT=broad-ctsa PYTHONPATH=$HOME/hail/hail/python python3 test.py

make check && make -C ../hail/python check && make copy-all && git add -u && git commit -m 'wip' && git push origin

 - scale test 300K on 1000 nodes
   - run larger with ulimit -n 1048576 (try without first)
   - turn off console

 - status UI
   - no, slightly more logging
 - move resources to somewhere like gs://hail-common/cseed/pipeline_google_backend/
 - rebuild image and test
 - service account?
 - check FIXME

 - keep an eye out for intermittent gsutil errors

 - run scale tests: 300, 3K, 30K, 300K, 3M
   - done: 30, 300, 3000, 30K

won't do:
 - log in another thread, put events on a queue

 - 30K, while running:
cotton   18233 59.1  0.7 1057796 228180 pts/1  Sl+  23:10   0:31 python3 scale-test.py 44 681
cotton   18233 25.1  1.3 5154568 426400 pts/1  Rl+  23:10   0:38 python3 scale-test.py 44 681
cotton   18233 23.1  1.4 5172948 453440 pts/1  Sl+  23:10   0:49 python3 scale-test.py 44 681



30K/800:
4% CPU
cotton    8647 20.0  1.5 3664248 483796 pts/0  Sl+  04:02   3:19 python3 scale-test.py 44 681
480MB
224.05user 13.44system 31:47.85elapsed 12%CPU (0avgtext+0avgdata 503080maxresident)k
232inputs+64464outputs (0major+258080minor)pagefaults 0swaps

3K/80:
0.5% CPU
INFO: pipeline succeeded!
15.19user 1.86system 24:21.21elapsed 1%CPU (0avgtext+0avgdata 240316maxresident)k
0inputs+6664outputs (0major+136639minor)pagefaults 0swaps

 - run tests (later)

get internal IP:
curl -H "Metadata-Flavor: Google" "http://metadata.google.internal/computeMetadata/v1/instance/network-interfaces/0/ip"

3 7 => 31
(+ 3 7 (* 3 7))

11 25 => 311
(+ 11 25 (* 11 25))

33 89 => 3059
(+ 33 89 (* 33 89))

44 681 => 30689
(+ 44 681 (* 44 681))

136 2200 => 301.5K
(+ 136 2200 (* 136 2200))

3K/80 in new setup:

INFO: pipeline succeeded!
14.24user 1.89system 14:26.33elapsed 1%CPU (0avgtext+0avgdata 184324maxresident)k
0inputs+6488outputs (0major+94582minor)pagefaults 0swaps
