FROM bitnami/minideb:buster

ENV LANG C.UTF-8

RUN echo 'deb http://ftp.us.debian.org/debian stretch main' >> /etc/apt/sources.list && \
  install_packages \
    openjdk-8-jdk-headless \
    python3 python3-pip ca-certificates

COPY hail/python/requirements.txt requirements.txt
COPY hail/python/dev-requirements.txt dev-requirements.txt
# without setuptools, most packages cannot install themselves
# re: pypandoc: https://stackoverflow.com/questions/51500288/unable-to-install-pyspark
RUN python3 -m pip install -U setuptools && \
    python3 -m pip install -U pypandoc && \
    python3 -m pip install -U -r requirements.txt -r dev-requirements.txt

COPY wheel-container.tar wheel-container.tar
RUN tar -xf wheel-container.tar && \
    python3 -m pip install hail-*-py3-none-any.whl

COPY pylintrc setup.cfg /
