# adds http_x_real_ip to the default `combined`
# http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format
log_format combined_real_ip '$http_x_real_ip - $remote_addr - $remote_user [$time_local] '
                            '"$request" $status $body_bytes_sent '
                            '"$http_referer" "$http_user_agent"';
# uses combined_real_ip format
# http://nginx.org/en/docs/http/ngx_http_log_module.html#access_log
access_log logs/access.log combined_real_ip;

server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name site;

    location = /health {
        return 200;
    }

    location = /docs/ {
        return 301 $scheme://$http_host/docs/0.2;
    }

    location ~ ^/hail(|/.*)$ {
        return 301 $scheme://$http_host/docs/0.1$1;
    }

    location ~ ^/docs/([^\/]+)/hailpedia/([^\/]*)$ {
        return 301 $scheme://$http_host/docs/0.2/overview/$2;
    }

    location ~ ^/docs/devel(|/.*)$ {
        return 301 $scheme://$http_host/docs/0.2$1;
    }

    location ~ ^/docs/stable(|/.*)$ {
        return 301 $scheme://$http_host/docs/0.2$1;
    }

    error_page 404 /404.html;

    location / {
        root /var/www/html;
    }
}
